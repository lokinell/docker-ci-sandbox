# Fig (http://www.fig.sh) configuration file
#

# LDAP service
#
# To create and strart LDAP service container:
#   $ fig up --no-recreate ldapinit
#   $ fig rm ldapinit
#   $ fig up -d ldap
# To start web UI for it:
#   $ fig up -d --no-recreate ldapadmin
#

ldap:
    build: ldap
    hostname: dev-ldap
    volumes_from:
        - ldapvolume
ldapinit:
    build: ldap
    user: root
    command: sh -e ./setup.sh
    volumes_from:
        - ldapvolume
    links:
        - ldapvolume
ldapvolume:
    image: volume
    volumes:
        - /var/lib/ldap

ldapadmin:
    build: ldap-admin
    hostname: dev-ldap-admin
    ports:
        - 127.0.0.1:8084:80
    links:
        - ldap:ldap


# Gerrit service
#
# To create and strart Gerrit service container:
#   $ fig up --no-recreate gerritinit
#   $ fig rm gerritinit
#   $ fig up -d gerrit
#
# To upgrade
#   $ fig stop gerrit
#   $ fig build gerrit
#   $ fig build gerritinit
# then follow the steps above to create and start Gerrit service container.
#

gerrit:
    build: gerrit
    hostname: dev-gerrit
    ports:
        - 127.0.0.1:8083:8080
        - 127.0.0.1:29418:29418
    volumes_from:
        - gerritvolume
    links:
        - ldap:ldap
    environment:
        http_proxy:

gerritinit:
    build: gerrit
    user: root
    command: sh -e ./setup.sh
    volumes_from:
        - gerritvolume
    links:
        - gerritvolume
    environment:
        http_proxy:

gerritvolume:
    image: volume
    volumes:
        - /var/lib/gerrit/data
        - /var/lib/gerrit/db
        - /var/lib/gerrit/git


# Nexus service
#
# To create and strart Nexus service container:
#   $ fig up nexusinit
#   $ fig rm nexusinit
#   $ fig up -d nexus
#

nexus:
    build: nexus
    hostname: dev-nexus
    ports:
        - 127.0.0.1:8082:8081
    volumes_from:
        - nexusvolume
    links:
        - ldap:ldap
    environment:
        http_proxy:

nexusinit:
    build: nexus
    user: root
    command: sh -e ./setup.sh
    volumes_from:
        - nexusvolume
    links:
        - nexusvolume
    environment:
        http_proxy:

nexusvolume:
    image: volume
    volumes:
        - /var/lib/sonatype-work/nexus


# Jenkins service
#
# To create and strart Jenkins service container:
#   $ fig up jenkinsinit
#   $ fig rm jenkinsinit
#   $ fig up -d jenkins
#

jenkins:
    build: jenkins
    hostname: dev-jenkins
    ports:
        - 127.0.0.1:8081:8080
    volumes_from:
        - jenkinsconfig
        - jenkinsdata
    links:
        - ldap:ldap
        - gerrit:gerrit
        - nexus:nexus
        - jenkinsslave
    environment:
        http_proxy:
jenkinsinit:
    build: jenkins
    user: root
    command: setup
    volumes_from:
        - jenkinsconfig
        - jenkinsdata
    links:
        - jenkinsconfig
        - jenkinsdata
    environment:
        http_proxy:
jenkinsconfig:
    image: volume
    volumes:
        - /var/lib/jenkins
jenkinsdata:
    image: volume
    volumes:
        - /var/lib/jenkins-builds
        - /var/lib/jenkins-ws


# Jenkins slave
#
# To create and start Jenkins slave (generally not required):
#   $ fig up -d jenkinsslave
#

jenkinsslave:
    build: jenkins-slave
    links:
        - gerrit:gerrit
        - nexus:nexus
    environment:
        http_proxy:

