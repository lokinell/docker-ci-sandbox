# Fig (http://www.fig.sh) configuration file
#

# LDAP service
#
# To create and strart LDAP service container:
#   $ fig up --no-recreate ldapInit
#   $ fig rm ldapInit
#   $ fig up -d ldap
# To start web UI for it:
#   $ fig up -d --no-recreate ldapAdmin
#

ldap:
    build: ldap
    hostname: dev-ldap
    volumes_from:
        - ldapVolume
ldapInit:
    build: ldap
    user: root
    command: sh -e ./setup.sh
    volumes_from:
        - ldapVolume
    links:
        - ldapVolume
ldapVolume:
    image: volume
    volumes:
        - /var/lib/ldap

ldapAdmin:
    build: ldap-admin
    hostname: dev-ldap-admin
    ports:
        - 127.0.0.1:8084:80
    links:
        - ldap:ldap


# Gerrit service
#
# To create and strart Gerrit service container:
#   $ fig up --no-recreate gerritInit
#   $ fig rm gerritInit
#   $ fig up -d gerrit
#
# To upgrade
#   $ fig stop gerrit
#   $ fig build gerrit
#   $ fig build gerritInit
# then follow the steps above to create and start Gerrit service container.
#

gerrit:
    build: gerrit
    hostname: dev-gerrit
    ports:
        - 127.0.0.1:8083:8080
        - 127.0.0.1:29418:29418
    volumes_from:
        - gerritVolume
    links:
        - ldap:ldap
    environment:
        http_proxy:

gerritInit:
    build: gerrit
    user: root
    command: sh -e ./setup.sh
    volumes_from:
        - gerritVolume
    links:
        - gerritVolume
    environment:
        http_proxy:

gerritVolume:
    image: volume
    volumes:
        - /var/lib/gerrit/data
        - /var/lib/gerrit/db
        - /var/lib/gerrit/git


# Nexus service
#
# To create and strart Nexus service container:
#   $ fig up nexusInit
#   $ fig rm nexusInit
#   $ fig up -d nexus
#

nexus:
    build: nexus
    hostname: dev-nexus
    ports:
        - 127.0.0.1:8082:8081
    volumes_from:
        - nexusVolume
    environment:
        http_proxy:

nexusInit:
    build: nexus
    user: root
    command: sh -e ./setup.sh
    volumes_from:
        - nexusVolume
    links:
        - nexusVolume
    environment:
        http_proxy:

nexusVolume:
    image: volume
    volumes:
        - /var/lib/sonatype-work/nexus


# Jenkins service
#
# To create and strart Jenkins service container:
#   $ fig up jenkinsInit
#   $ fig rm jenkinsInit
#   $ fig up -d jenkins
#

jenkins:
    build: jenkins
    hostname: dev-jenkins
    ports:
        - 127.0.0.1:8081:8080
    volumes_from:
        - jenkinsConfig
        - jenkinsData
    links:
        - ldap:ldap
        - gerrit:gerrit
        - nexus:nexus
        - jenkinsSlave
    environment:
        http_proxy:
jenkinsInit:
    build: jenkins
    user: root
    command: setup
    volumes_from:
        - jenkinsConfig
        - jenkinsData
    links:
        - jenkinsConfig
        - jenkinsData
    environment:
        http_proxy:
jenkinsConfig:
    image: volume
    volumes:
        - /var/lib/jenkins
jenkinsData:
    image: volume
    volumes:
        - /var/lib/jenkins-builds
        - /var/lib/jenkins-ws


# Jenkins slave
#
# To create and start Jenkins slave (generally not required):
#   $ fig up -d jenkinsSlave
#

jenkinsSlave:
    build: jenkins-slave
    links:
        - gerrit:gerrit
        - nexus:nexus
    environment:
        http_proxy:

